

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Testing Module &mdash; METviewer develop documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://dtcenter.github.io/METviewer/latest/Users_Guide/testing.html"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="METviewer develop documentation" href="../index.html"/>
        <link rel="up" title="User’s Guide" href="index.html"/>
        <link rel="next" title="7. METviewer Web Service" href="web_service.html"/>
        <link rel="prev" title="5. Database Scrubbing Module" href="database_scrubbing.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> METviewer
          

          
            
            <img src="../_static/met_viewer_logo_2019_09.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>develop</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">METviewer</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">1. Overview of METviewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">2. METviewer Installation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html">3. Common XML Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="database_loading.html">4. Database Loading Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="database_scrubbing.html">5. Database Scrubbing Module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. Testing Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-example-install-and-run-on-dakota">6.1. Testing example - install and run on dakota</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-capture">6.2. Testing - capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-verify">6.3. Testing - verify</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-test">6.4. auto test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-submodules">6.5. Testing submodules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="web_service.html">7. METviewer Web Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="batch.html">8. Batch Plotting Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="seriesplots.html">9. Series Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="barplots.html">10. Bar Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="boxplot.html">11. Box Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="rocplot.html">12. Receiver Operating Characteristic (ROC) Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="reliabilityplots.html">13. Reliability Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="perfdiag.html">14. Performance Diagrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="taylordiag.html">15. Taylor Diagrams</a></li>
<li class="toctree-l2"><a class="reference internal" href="contourplot.html">16. Contour Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="spreadskillplot.html">17. Spread vs. Skill Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="eclvplots.html">18. Economic Cost/Loss Value Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="scorecard.html">19. Scorecards</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">METviewer</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">6. </span>Testing Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Users_Guide/testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-module">
<h1><span class="section-number">6. </span>Testing Module<a class="headerlink" href="#testing-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="testing-example-install-and-run-on-dakota">
<h2><span class="section-number">6.1. </span>Testing example - install and run on dakota<a class="headerlink" href="#testing-example-install-and-run-on-dakota" title="Permalink to this headline">¶</a></h2>
<p><strong>Testing directory and branch information</strong></p>
<div class="line-block">
<div class="line">Testing HOME directory: <em>/d3/projects/METViewer/auto_test</em></div>
<div class="line">Testing data directory: <em>/d3/projects/METViewer/test_data/load_data/load</em></div>
<div class="line">Branch to verify against: mv_2_5_dev</div>
<div class="line">Branch to verify : mv_2_6</div>
<div class="line"><br /></div>
</div>
<p><strong>Steps</strong></p>
<ol class="arabic">
<li><p>Check out and copy to the HOME script : <strong>auto_test.sh</strong></p></li>
<li><p>Create a database for the branch to verify against (mv_2_5_dev):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mysql -uUSER -p -e &#39;create database mv_test_mv_2_5_dev&#39;
</pre></div>
</div>
</li>
<li><p>Clone and build the branch to verify against (mv_2_5_dev):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./auto_test.sh -UGIT_USER -t/d3/projects/METViewer/auto_test/METViewerTest -bmv_2_5_dev -Bmv_2_5_dev -l/d3/projects/METViewer/test_data/load_data/load -dmv_test_2_5_dev -uUSER -m/d3/projects/METViewer/auto_test/METViewer -pUSER -hHOST -P3306
</pre></div>
</div>
</li>
<li><p>Create a database for the branch to verify (mv_2_6):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mysql -uUSER -p -e &#39;create database mv_test_mv_2_6&#39;
</pre></div>
</div>
</li>
<li><p>Clone, build and verify the branch:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./auto_test.sh -UGIT_USER -t/d3/projects/METViewer/auto_test/METViewerTest -bmv_2_6 -Bmv_2_5_dev -l/d3/projects/METViewer/test_data/load_data/load -dmv_test_2_6 -uUSER -m/d3/projects/METViewer/auto_test/METViewer -pUSER -hHOST -P3306
</pre></div>
</div>
</li>
</ol>
<p>If the testing is done using crontab the git user credentials should be
stored in the
<a class="reference external" href="https://git-scm.com/book/en/v2/Git-Tools-Credential-Storage">git store</a> .
Also, <strong>auto_test.sh</strong> should be modified to send emails with testing results.</p>
</div>
<div class="section" id="testing-capture">
<h2><span class="section-number">6.2. </span>Testing - capture<a class="headerlink" href="#testing-capture" title="Permalink to this headline">¶</a></h2>
<p>The testing module is used to execute the regression testing of a specified
version of METviewer. The capture tool is invoked by using the mv_test.sh
script. During test capture, system or processing errors will be reported
but images and data are not verified. Verification of data or images is
performed by the mv_compare.sh script. The mv_test.sh script essentially
generates output files and copies them from the output directory to the
appropriate directory test_cases directory.</p>
<p>Capture and Verification are performed against a specified METviewer branch
and tag. It is expected that the proper branch or tag has been previously
fetched or cloned and checked out into the METviewer home directory that is
specified with -m (the auto test script does check out specific code and
then runs test capture and compare - see below). The METviewer test
directory should also be a subdirectory that corresponds to the proper
branch and tag, with an output directory that will contain the generated
images, scripts and data for a given test run, along with the corresponding
test_data (use case xml files) and load data (load specification xml
files). The actual load data files are not yet source controlled and so they
are linked from the path to the met data that is specified with the -l
option. The auto_test.sh script takes branch and tag parameters and creates
the proper test subdirectory and reconciles properly with the remote
repository. All the mv_test.sh script needs is the proper test subdirectory.
Successfully generated output images will be copied to the appropriate
test_cases directory.</p>
<p><strong>NOTE ABOUT GIT TAGS</strong></p>
<p>A short discussion of METviewer git tags is appropriate here. Git tags are not
directly related to any git branches. They are different things. A git tag
simply refers to a specific commit to the git repository. The branches that
existed at the time of the tagging could all be deleted (except for the master)
and the tag would still be a valid tag. In METviewer, tags are named after the
branches, i.e. MV_2_6_&lt;tag_name&gt;. This creates a mnemonic relationship to a
branch. Furthermore, only create tags after a commit to a specific branch that
is then referenced in the tag name. That tagged commit is a special point in
the history of the repository, a point to be captured for a given branch. By
specifying the tag and branch, the repository pointer is set to a specific
commit for a given branch.  Including a branch name is only a mnemonic that
serves as a reminder of the branch the tag was set on behalf of. The mnemonic
allows organization of the tests for regression checking against special times
in the repository commit history.</p>
<p><strong>NOTE</strong> To do binary comparisons on captured test data,
the test data is saved in a directory structure that is mnemonically tied
to the product branches or tags. The METviewer code under test is only ever
checked out to one specific branch HEAD, or to a tag point, at a time. Its
produced data and images may be compared, however, to data that was
captured by a different version or tag point of METviewer code. This test
directory structure might look like this, for example…</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>METVIEWER_TEST_DIR/
    MV_2_5/
        HEAD/
            test_data/
                test_cases
                    diff_grouping
                        xml plot specification files
                        expected .png files
                    ens_ss
                        xml plot specification files
                        expected .png files
                    loading
                        xml plot specification files
                        expected .png files
                    phist
                        xml plot specification files
                        expected .png files
                    plot_afwa_thresh
                        xml plot specification files
                        expected .png files
                    rely
                        xml plot specification files
                        expected .png files
                    rhist
                        xml plot specification files
                        expected .png files
                    series_sum_stat
                        xml plot specification files
                        expected .png files
            met_data
                ens_vsdb
                    data dirs
                noahmp
                    data dirs
                precip_vsdb
                    data dirs
                meso_vsdb
                    data dirs
                grid_stat
                    data dirs
                afwaoc
                    data dirs
                point_stat
                    data dirs
                ensemble_stat
                    data dirs
            load_data
                load
                    mv_mysql.sql
                    load_test.xml
            output
                data/
                    generated data files
                plots/
                    generated .png files
                scripts/
                    generated script files
                sql/
                    generated sql files
                xml/
                    generated xml files
            R_work/
                    generated R scripts
            R_tmpl (link to METviewer R_tmpl)
        TAG1/
            ...
        TAG2/
            ...
    MV_2_6/
        ...
</pre></div>
</div>
</div>
<div class="section" id="testing-verify">
<h2><span class="section-number">6.3. </span>Testing - verify<a class="headerlink" href="#testing-verify" title="Permalink to this headline">¶</a></h2>
<p>The mv_compare.sh script accepts a branch and a tag that it uses to identify a test subdirectory and a second “expected” branch and tag that it uses to identify a comparison test directory. If tags are omitted the HEAD is used. The compare script looks for corresponding image files in the corresponding plots directories and does a binary comparison of the corresponding files. Differences will be reported as errors.</p>
</div>
<div class="section" id="auto-test">
<h2><span class="section-number">6.4. </span>auto test<a class="headerlink" href="#auto-test" title="Permalink to this headline">¶</a></h2>
<p>The auto_test.sh script defines the branch, optionally a tag, directories, and database credentials for a version under test and a comparison version. It performs the following steps.</p>
<ol class="arabic simple">
<li><p>Remove any <em>METviewer</em> directory and <em>METviewerTestSource</em> directory.</p></li>
<li><p>Do a git clone into the <em>METviewer</em> home directory and checkout the corresponding branch or tag.</p></li>
<li><p>Do a git clone of the METviewer testing repository into the <em>METviewerTestSource</em> directory (this is not the test directory).</p></li>
<li><p>If needed create a <em>METVIEWER_TEST_DIR</em> subdirectory for the specified branch and load common data from the <em>METviewerTestSource</em> into it.</p></li>
<li><p>Run the testing capture program to capture test data for the specified branch, and copy the data to the corresponding test subdirectory.</p></li>
<li><p>Run the testing verify program to verify the images in the two corresponding test subdirectories.</p></li>
</ol>
<p>auto_test example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./bin/auto_test.sh -Usomegituser -t/myhomedir/METViewerTest -bmv_2_5_dev -Bmv_2_5_dev -l/myhomedir/METViewerTestData -dmydb -umet_admin -m/myhomedir/METViewer -pdppassword -hdphost -P3306
</pre></div>
</div>
<p>mv_test example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/bin/sh ./bin/mv_test.sh -t/myhomedir/METViewerTest/mv_2_5_dev/HEAD -m/myhomedir/METViewer -dmydb -umet_admin -pdppassword -hdphost -P3306 -l -c
</pre></div>
</div>
<p>mv_compare example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/bin/sh ./bin/mv_compare.sh -m /myhomedir/METViewer -t /myhomedir/METViewerTest/mv_2_5_dev/HEAD -c /myhomedir/METViewerTest/mv_2_5_dev/HEAD
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>---- Auto Test ----

Usage: auto_test.sh
-U &lt;git user&gt; -t&lt;path to METviewer test directory&gt; -b&lt;git branch&gt; -B&lt;compare git branch&gt; -l&lt;path to met data&gt; -d&lt;mv_database&gt; -m&lt;path to METViewer home&gt; [-a address list] [-g&lt;git tag&gt;] [-G&lt;compare git tag&gt;] [-u&lt;mv_user&gt;] [-p&lt;mv_passwd&gt;] [-h&lt;mv_host&gt;] [-P&lt;mv_port&gt;] [-j&lt;path to java executable&gt;]

Where:
-U &lt;git user with access to github.com/NCAR/METViewer.git and https://github.com/NCAR/METViewer-test.git&gt;
-t &lt;path to METviewer test directory&gt;
-b &lt;git branch&gt;
-B &lt;compare git branch&gt;
-l &lt;path to met data&gt; causes the LoadDataTest submodule to be executed, gets met data from specified path
\-d &lt;mv_database&gt;
-m &lt;path to METviewer home&gt;
[-a &lt;address list&gt;] commas separated email addresses - default sends output to console
[-g &lt;git tag&gt;] default is HEAD
[-G &lt;compare git tag&gt;] default is HEAD
[-u &lt;mv_user&gt;] default is mvuser
[-p &lt;mv_passwd&gt;] default is mvuser
[-h &lt;mv_host&gt;] default is dakota.rap.ucar.edu
[-P &lt;mv_port&gt;] default is 3306
[-j &lt;path to an alternate java executable&gt;] default is found in PATH environment

---- Auto Test Done ----
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>---- Capture ----

Usage: mv_test.sh -t&lt;path to METviewer test directory&gt; -b&lt;git branch&gt; [-g&lt;git tag&gt;] [-m&lt;path to METviewer home&gt;] [-d&lt;mv_database&gt;] [-u&lt;mv_user&gt;] [-p&lt;mv_passwd&gt;] [-h&lt;mv_host&gt;] [-P&lt;mv_port&gt;] [-j&lt;path to java executable&gt;] [-c] [-n] [-l]

Where:
-t &lt;path to METviewer test directory&gt;
[-m &lt;path to METviewer home&gt;] default is /d3/projects/METviewer/src_dev/apps/METviewer
[-d &lt;mv_database&gt;] default is mv_test
[-u &lt;mv_user&gt;] default is mvuser
[-p &lt;mv_passwd&gt;] default is mvuser
[-h &lt;mv_host&gt;] default is dakota.rap.ucar.edu
[-P &lt;mv_port&gt;] default is 3306
[-j &lt;path to an alternate java executable&gt;] default is found in PATH environment
[-n] causes no clean - i.e. test created data and plots will remain after the test completes, default is to clean prior to and after running
[-l] causes the LoadDataTest submodule to be executed, default is to not load data, gets met data from METviewer test directory meta_data
[-c] Captures created output data and copies it into the test directory. Prior to doing this the compare will fail [-X] Do not compare output automatically - only create images


---- capture Done ----
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>---- Verify ----

Usage: mv_compare.sh [-b&lt;git branch&gt;] [-g&lt;git tag&gt;] [-B&lt;compare git branch&gt;] [-G&lt;expected git tag&gt;] [-m&lt;path to METviewer home&gt;] [-t&lt;path to METviewer test directory&gt;] [-j&lt;path to java executable&gt;]

Where:
-t &lt;path to METviewer test directory&gt;
-b &lt;git branch&gt;
-B &lt;compare git branch&gt;
[-g &lt;git tag&gt;] default is HEAD
[-G &lt;expected git tag&gt;] default is HEAD
[-m &lt;path to METviewer home&gt;] default is /d3/projects/METViewer/src_dev/apps/METViewer
[-j &lt;path to an alternate java executable&gt;] default is found in PATH environment


---- Verify Done ----
</pre></div>
</div>
<p>The testing and comparison modules produce output files (images, points,
XML, data) and compare them with the expected output. In order for tests
to pass, produced and expected files should be byte identical.</p>
<p>NOTE: R scripts create visually similar results but bitwise different
image files on different platforms.</p>
</div>
<div class="section" id="testing-submodules">
<h2><span class="section-number">6.5. </span>Testing submodules<a class="headerlink" href="#testing-submodules" title="Permalink to this headline">¶</a></h2>
<p><strong>LoadDataTest</strong> recreates and refills the mv_test database with MET output
data and compares the number of rows in each table with the expected number.
Test data and XML configuration file are located in the <em>&lt;test_dir&gt;/load_data</em>
directory.</p>
<p><strong>CreatePlotBatchTest</strong> runs MVBatch with testing plot specification files
and creates output files with the expected output. Any errors encountered
with creating plots will be reported. Images are not compared
Plot specification files and expected output are located in the
<em>&lt;test_dir&gt;/plots_batch/&lt;test_type&gt;</em> directory.</p>
<p><strong>ComparePlotBatchTest</strong> compares a test ROOT_DIR with a test COMPARE+DIR.
These directories are specified by the testdir and compare dir.
plot specification files and expected output are located in the
<em>&lt;test_dir&gt;/test_data_test_cases/&lt;test_type&gt;</em> directories.</p>
<p><strong>TestMVServlet</strong> simulates POST intermediate requests (ex. get a list of
variables), send them to MVServlet and compare the servlet’s response
with the expected output. Requests files and expected response are located
in the <em>&lt;test_dir&gt;/servlet/</em> directory.</p>
<p><strong>CreatePlotServletTest</strong> simulates POST, creates plot requests, sends
them to MVServlet and compares produced output files with the expected output.
Requests files and expected output files are located in the
<em>&lt;test_dir&gt;/plots_web/&lt;test_type&gt;</em> directory.</p>
<p>Location of <em>&lt;test_dir&gt;</em> : <em>/d3/projects/METViewer/test_data/</em></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="web_service.html" class="btn btn-neutral float-right" title="7. METviewer Web Service" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="database_scrubbing.html" class="btn btn-neutral" title="5. Database Scrubbing Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, UCAR/NCAR.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/pop_ver.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>