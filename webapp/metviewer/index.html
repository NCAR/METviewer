<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>METViewer</title>
    <link rel="stylesheet" type="text/css" href="include/metviewer.css" />
    <link rel="shortcut icon" href="include/favicon.ico" type="image/x-icon" />
</head>

<body onLoad="onLoad()" style="padding-left:20px">

<script type="text/javascript"><!--

var _url;
var _txtResponse;
var _txtPost;
var _txtGet;
var _selDB;

function onLoad(){
	_url			= window.location + "servlet";
	_txtResponse	= document.getElementById("txtResponse");
	_txtPost		= document.getElementById("txtPost");
	_txtGet			= document.getElementById("txtGet");
	_selDB			= document.getElementById("selDB");

	listDB();
}

function getRequest(){
	var req;
	if (window.XMLHttpRequest) { req = new XMLHttpRequest(); }
	else if (window.ActiveXObject) {
		try{ req = new ActiveXObject("Microsoft.XMLHTTP"); } 
		catch (e) { try { req = new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {} }
	}
	return req;
}

function sendRequest(reqType, reqData){

	//  set the request to wait until the data is ready
	var strResp = "";
	var req = getRequest();
	req.onreadystatechange =
    function() {
		if (req.readyState == 4) {
			if (req.status == 200) { strResp = req.responseText; }
			else                   { strResp = "ERROR: req.status = " + req.status; }
			processResponse(reqData, strResp);
        }
	};

	var reqURL = _url + "?date=" + (new Date()).getMilliseconds();
  
	//  send the request in the manner specified
    if( reqType == "GET" ){
		req.open(reqType, reqURL + "&data=" + encodeURI(reqData), true);
		req.send(null);
	} else {
		var reqPostData = "<request>" + reqData + "</request>";
		req.open(reqType, reqURL, true);
		req.setRequestHeader("Content-Type", "text/xml");
		req.setRequestHeader("Content-length", reqPostData.length);
		req.setRequestHeader("Connection", "close");
		req.send(reqPostData);
	}
}

function processResponse(strReq, strResp){
	console("response: " + strResp + "\n");

	if( null != (listParse = strReq.match( /list_db/ )) ){
		//  parse the list of databases
		var listDB = strResp.replace(/<list_db><db>/, "").replace(/<\/db><\/list_db>/, "").split( /<\/db><db>/ );

		//  clear the database select list and populate it with the database list
		while( 0 < _selDB.length ){ _selDB.remove(_selDB.selectedIndex); }		
		for(intDB in listDB){
			var optDB = document.createElement('option');
			optDB.text=listDB[intDB];
			try{ _selDB.add(optDB, null); }catch(ex){ _selDB.add(optDB); }
		}
	}

	else if( null != (listParse = strReq.match( /connect_db/ )) ){
		//  parse the list of databases
		var listDB = strResp.replace(/<list_db><db>/, "").replace(/<\/db><\/list_db>/, "").split( /<\/db><db>/ );

		//  clear the database select list and populate it with the database list
		while( 0 < _selDB.length ){ _selDB.remove(_selDB.selectedIndex); }		
		for(intDB in listDB){
			var optDB = document.createElement('option');
			optDB.text=listDB[intDB];
			try{ _selDB.add(optDB, null); }catch(ex){ _selDB.add(optDB); }
		}
	}
}

function testPost(){
	sendRequest("POST", _txtPost.value);
}

function testGet(){
	sendRequest("GET", _txtGet.value);
}

function listDB(){
	sendRequest("POST", "<list_db/>");
}

function selectDB(){
	sendRequest("POST", "<connect_db>" + _selDB.options[_selDB.selectedIndex].text + "</connect_db>");	
}

function console(str){ _txtResponse.innerHTML += str; }

//--></script>

<h2>METViewer</h2>
<p>
	Welcome to METViewer<br/>
	
	<input type="text" id="txtPost"/>
	<input type="button" class="gButton" onclick="javascript:testPost()" value="Post"/><br/><br/>
	
	<input type="text" id="txtGet"/>
	<input type="button" class="gButton" onclick="javascript:testGet()" value="Get"/><br/><br/>
	
	<select id="selDB"></select>
	<!-- <input type="button" class="gButton" onclick="javascript:listDB()" value="List"/> -->
	<input type="button" class="gButton" onclick="javascript:selectDB()" value="Select"/><br/><br/>
	<span id="spanDBStatus">Disconnected</span>

	<b>Response:</b><br/>
	<textarea rows="20" cols="80" id="txtResponse"></textarea>
</p>

</body>
</html>
